<!DOCTYPE html>
<html>
<head>
    <title>PWA Bridge - Legado Av√≠cola</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<script>
// Este script se ejecuta en el contexto de github.io
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        console.log('üîÑ Iniciando registro del Service Worker desde bridge');
        
        // Registrar el SW con opciones mejoradas
        navigator.serviceWorker.register('/firebase-config/sw.js', { 
            scope: '/firebase-config/' 
        })
        .then(reg => {
            console.log('‚úÖ SW registrado desde bridge');
            
            // Verificar si hay actualizaciones
            reg.addEventListener('updatefound', () => {
                const newWorker = reg.installing;
                console.log('üÜï Nueva versi√≥n del SW detectada');
                
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        console.log('üîÑ Nueva versi√≥n lista para activarse');
                        // Notificar a la p√°gina que hay una nueva versi√≥n
                        if (window.parent) {
                            window.parent.postMessage('sw-update-available', 'https://cmbt-2211-94b-omega.blogspot.com');
                        }
                    }
                });
            });
            
            // Enviar mensaje de que el SW est√° listo
            if (window.parent) {
                window.parent.postMessage('sw-ready', 'https://cmbt-2211-94b-omega.blogspot.com');
            }
            
            // Verificar conectividad
            setInterval(() => {
                if (navigator.onLine) {
                    if (window.parent) {
                        window.parent.postMessage('online-status:true', 'https://cmbt-2211-94b-omega.blogspot.com');
                    }
                } else {
                    if (window.parent) {
                        window.parent.postMessage('online-status:false', 'https://cmbt-2211-94b-omega.blogspot.com');
                    }
                }
            }, 3000);
        })
        .catch(err => {
            console.error('‚ùå Error en bridge:', err);
            if (window.parent) {
                window.parent.postMessage('sw-error:' + err.message, 'https://cmbt-2211-94b-omega.blogspot.com');
            }
        });
    });
} else {
    console.warn('‚ö†Ô∏è Service Workers no soportados');
    if (window.parent) {
        window.parent.postMessage('sw-not-supported', 'https://cmbt-2211-94b-omega.blogspot.com');
    }
}
</script>
</body>
</html>
