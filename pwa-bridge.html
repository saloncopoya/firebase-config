<!DOCTYPE html>
<html>
<head>
    <title>PWA Bridge</title>
    <meta charset="UTF-8">
</head>
<body>
<script>
(function() {
    console.log('üîÑ PWA Bridge iniciado');
    
    if (!('serviceWorker' in navigator)) {
        if (window.parent) {
            window.parent.postMessage('sw-error:no-support', '*');
        }
        return;
    }
    
    // Registrar SW
    navigator.serviceWorker.register('/firebase-config/sw.js', { 
        scope: '/firebase-config/'
    })
    .then(registration => {
        console.log('‚úÖ SW registrado');
        
        // Verificar si ya est√° activo
        if (registration.active) {
            if (window.parent) {
                window.parent.postMessage('sw-ready', '*');
            }
        }
        
        // Escuchar cambios
        registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            console.log('üÜï Nueva versi√≥n detectada');
            
            newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'activated') {
                    if (window.parent) {
                        window.parent.postMessage('sw-updated', '*');
                    }
                }
            });
        });
        
        // Verificar conectividad
        setInterval(() => {
            if (window.parent) {
                window.parent.postMessage(
                    'online-status:' + navigator.onLine, 
                    '*'
                );
            }
        }, 2000);
    })
    .catch(error => {
        console.error('‚ùå Error:', error);
        if (window.parent) {
            window.parent.postMessage('sw-error:' + error.message, '*');
        }
    });
})();
</script>
</body>
</html>
