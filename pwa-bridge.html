<!DOCTYPE html>
<html>
<head>
    <title>PWA Bridge - PAVANNA</title>
    <meta charset="UTF-8">
</head>
<body>
    <script>
        (function() {
            console.log('üîÑ PWA Bridge iniciado');
            
            if (!('serviceWorker' in navigator)) {
                console.error('‚ùå Service Workers no soportados');
                if (window.parent) {
                    window.parent.postMessage('sw-error:no-support', '*');
                }
                return;
            }
            
            function registrarSW() {
                navigator.serviceWorker.register('/firebase-config/sw.js', { 
                    scope: '/firebase-config/'
                }).then(function(registration) {
                    console.log('‚úÖ SW registrado correctamente');
                    
                    if (registration.active) {
                        if (window.parent) {
                            window.parent.postMessage('sw-ready', '*');
                        }
                    }
                    
                    registration.addEventListener('updatefound', function() {
                        var newWorker = registration.installing;
                        console.log('üÜï Nueva versi√≥n detectada');
                        
                        newWorker.addEventListener('statechange', function() {
                            if (newWorker.state === 'activated') {
                                if (window.parent) {
                                    window.parent.postMessage('sw-updated', '*');
                                }
                            }
                        });
                    });
                    
                    setInterval(function() {
                        if (window.parent) {
                            window.parent.postMessage('online-status:' + navigator.onLine, '*');
                        }
                    }, 2000);
                    
                }).catch(function(error) {
                    console.error('‚ùå Error registrando SW:', error);
                    if (window.parent) {
                        window.parent.postMessage('sw-error:' + error.message, '*');
                    }
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', registrarSW);
            } else {
                registrarSW();
            }
        })();
    </script>
</body>
</html>
